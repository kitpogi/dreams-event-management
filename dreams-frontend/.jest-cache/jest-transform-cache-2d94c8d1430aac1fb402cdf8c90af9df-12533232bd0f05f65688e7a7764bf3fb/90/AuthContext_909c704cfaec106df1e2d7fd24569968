0da6044ef02989f84da73b54684ed0a9
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useAuth = exports.AuthProvider = void 0;
var _react = require("react");
var _axios = _interopRequireDefault(require("../api/axios"));
var _imageUtils = require("../utils/imageUtils");
var _jsxRuntime = require("react/jsx-runtime");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const AuthContext = /*#__PURE__*/(0, _react.createContext)();
const useAuth = () => {
  const context = (0, _react.useContext)(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};
exports.useAuth = useAuth;
const AuthProvider = ({
  children
}) => {
  const [user, setUser] = (0, _react.useState)(null);
  const [token, setToken] = (0, _react.useState)(null);
  const [loading, setLoading] = (0, _react.useState)(true);
  (0, _react.useEffect)(() => {
    const storedToken = localStorage.getItem('token');
    const userData = localStorage.getItem('user');
    if (storedToken && userData) {
      setToken(storedToken);
      setUser(JSON.parse(userData));
      // Fetch current user to verify token is still valid
      fetchCurrentUser();
    } else {
      setLoading(false);
    }
  }, []);
  const fetchCurrentUser = async () => {
    try {
      const response = await _axios.default.get('/auth/me');
      const userData = response.data;

      // Ensure profile picture URL is absolute
      if (userData.profile_picture) {
        userData.profile_picture = (0, _imageUtils.ensureAbsoluteUrl)(userData.profile_picture);
      }
      setUser(userData);
      localStorage.setItem('user', JSON.stringify(userData));
      return {
        success: true,
        user: userData
      };
    } catch (error) {
      // Token invalid, clear storage
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      setToken(null);
      setUser(null);
      return {
        success: false,
        message: error.response?.data?.message || 'Failed to fetch user'
      };
    } finally {
      setLoading(false);
    }
  };
  const login = async (email, password) => {
    try {
      // Validate inputs before sending
      if (!email || !password) {
        return {
          success: false,
          message: 'Email and password are required'
        };
      }
      const response = await _axios.default.post('/auth/login', {
        email,
        password
      });
      const {
        token: newToken,
        user: userData
      } = response.data;

      // Ensure profile picture URL is absolute
      if (userData.profile_picture) {
        userData.profile_picture = (0, _imageUtils.ensureAbsoluteUrl)(userData.profile_picture);
      }
      localStorage.setItem('token', newToken);
      localStorage.setItem('user', JSON.stringify(userData));
      setToken(newToken);
      setUser(userData);
      return {
        success: true
      };
    } catch (error) {
      let message = 'Login failed';
      if (error.response?.status === 422) {
        // Validation errors
        const errors = error.response.data?.errors;
        if (errors) {
          // Get first error message
          const errorKeys = Object.keys(errors);
          if (errorKeys.length > 0) {
            const firstError = errors[errorKeys[0]];
            message = Array.isArray(firstError) ? firstError[0] : firstError;
          } else {
            message = error.response.data?.message || 'Validation failed';
          }
        } else {
          message = error.response.data?.message || message;
        }
      } else if (error.response?.status === 401) {
        message = 'Invalid email or password';
      } else {
        message = error.response?.data?.message || message;
      }
      console.error('Login error:', error.response?.data || error.message);
      return {
        success: false,
        message: message
      };
    }
  };
  const register = async userData => {
    try {
      const response = await _axios.default.post('/auth/register', userData);
      const {
        token: newToken,
        user: newUser,
        message
      } = response.data;

      // Ensure profile picture URL is absolute
      if (newUser.profile_picture) {
        newUser.profile_picture = (0, _imageUtils.ensureAbsoluteUrl)(newUser.profile_picture);
      }
      localStorage.setItem('token', newToken);
      localStorage.setItem('user', JSON.stringify(newUser));
      setToken(newToken);
      setUser(newUser);
      return {
        success: true,
        message: message || 'Registration successful! Please check your email to verify your account.'
      };
    } catch (error) {
      let message = 'Registration failed';
      if (error.response?.status === 422) {
        // Validation errors
        const errors = error.response.data?.errors;
        if (errors) {
          const errorKeys = Object.keys(errors);
          if (errorKeys.length > 0) {
            const firstError = errors[errorKeys[0]];
            message = Array.isArray(firstError) ? firstError[0] : firstError;
          } else {
            message = error.response.data?.message || message;
          }
        } else {
          message = error.response.data?.message || message;
        }
      } else {
        message = error.response?.data?.message || message;
      }
      return {
        success: false,
        message: message
      };
    }
  };
  const logout = async () => {
    try {
      await _axios.default.post('/auth/logout');
    } catch (error) {
      if (error.response?.status !== 401) {
        console.error('Logout error:', error);
      }
    } finally {
      // Clear state first
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      setToken(null);
      setUser(null);
    }
  };
  const updateUser = userData => {
    // Ensure profile picture URL is absolute before updating
    if (userData.profile_picture) {
      userData.profile_picture = (0, _imageUtils.ensureAbsoluteUrl)(userData.profile_picture);
    }
    setUser(userData);
    localStorage.setItem('user', JSON.stringify(userData));
  };
  const value = {
    user,
    token,
    setUser,
    setToken,
    login,
    register,
    logout,
    fetchCurrentUser,
    updateUser,
    loading,
    isAuthenticated: !!user && !!token,
    // Coordinators have admin privileges
    isAdmin: user?.role === 'admin' || user?.role === 'coordinator',
    isCoordinator: user?.role === 'coordinator'
  };
  return /*#__PURE__*/(0, _jsxRuntime.jsx)(AuthContext.Provider, {
    value: value,
    children: children
  });
};
exports.AuthProvider = AuthProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2F4aW9zIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9pbWFnZVV0aWxzIiwiX2pzeFJ1bnRpbWUiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJBdXRoQ29udGV4dCIsImNyZWF0ZUNvbnRleHQiLCJ1c2VBdXRoIiwiY29udGV4dCIsInVzZUNvbnRleHQiLCJFcnJvciIsImV4cG9ydHMiLCJBdXRoUHJvdmlkZXIiLCJjaGlsZHJlbiIsInVzZXIiLCJzZXRVc2VyIiwidXNlU3RhdGUiLCJ0b2tlbiIsInNldFRva2VuIiwibG9hZGluZyIsInNldExvYWRpbmciLCJ1c2VFZmZlY3QiLCJzdG9yZWRUb2tlbiIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJ1c2VyRGF0YSIsIkpTT04iLCJwYXJzZSIsImZldGNoQ3VycmVudFVzZXIiLCJyZXNwb25zZSIsImFwaSIsImdldCIsImRhdGEiLCJwcm9maWxlX3BpY3R1cmUiLCJlbnN1cmVBYnNvbHV0ZVVybCIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJzdWNjZXNzIiwiZXJyb3IiLCJyZW1vdmVJdGVtIiwibWVzc2FnZSIsImxvZ2luIiwiZW1haWwiLCJwYXNzd29yZCIsInBvc3QiLCJuZXdUb2tlbiIsInN0YXR1cyIsImVycm9ycyIsImVycm9yS2V5cyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJmaXJzdEVycm9yIiwiQXJyYXkiLCJpc0FycmF5IiwiY29uc29sZSIsInJlZ2lzdGVyIiwibmV3VXNlciIsImxvZ291dCIsInVwZGF0ZVVzZXIiLCJ2YWx1ZSIsImlzQXV0aGVudGljYXRlZCIsImlzQWRtaW4iLCJyb2xlIiwiaXNDb29yZGluYXRvciIsImpzeCIsIlByb3ZpZGVyIl0sInNvdXJjZXMiOlsiQXV0aENvbnRleHQuanN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNvbnRleHQsIHVzZVN0YXRlLCB1c2VDb250ZXh0LCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBhcGkgZnJvbSAnLi4vYXBpL2F4aW9zJztcclxuaW1wb3J0IHsgZW5zdXJlQWJzb2x1dGVVcmwgfSBmcm9tICcuLi91dGlscy9pbWFnZVV0aWxzJztcclxuXHJcbmNvbnN0IEF1dGhDb250ZXh0ID0gY3JlYXRlQ29udGV4dCgpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHVzZUF1dGggPSAoKSA9PiB7XHJcbiAgY29uc3QgY29udGV4dCA9IHVzZUNvbnRleHQoQXV0aENvbnRleHQpO1xyXG4gIGlmICghY29udGV4dCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCd1c2VBdXRoIG11c3QgYmUgdXNlZCB3aXRoaW4gYW4gQXV0aFByb3ZpZGVyJyk7XHJcbiAgfVxyXG4gIHJldHVybiBjb250ZXh0O1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IEF1dGhQcm92aWRlciA9ICh7IGNoaWxkcmVuIH0pID0+IHtcclxuICBjb25zdCBbdXNlciwgc2V0VXNlcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICBjb25zdCBbdG9rZW4sIHNldFRva2VuXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgY29uc3Qgc3RvcmVkVG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndG9rZW4nKTtcclxuICAgIGNvbnN0IHVzZXJEYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXInKTtcclxuICAgIFxyXG4gICAgaWYgKHN0b3JlZFRva2VuICYmIHVzZXJEYXRhKSB7XHJcbiAgICAgIHNldFRva2VuKHN0b3JlZFRva2VuKTtcclxuICAgICAgc2V0VXNlcihKU09OLnBhcnNlKHVzZXJEYXRhKSk7XHJcbiAgICAgIC8vIEZldGNoIGN1cnJlbnQgdXNlciB0byB2ZXJpZnkgdG9rZW4gaXMgc3RpbGwgdmFsaWRcclxuICAgICAgZmV0Y2hDdXJyZW50VXNlcigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfSwgW10pO1xyXG5cclxuICBjb25zdCBmZXRjaEN1cnJlbnRVc2VyID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGkuZ2V0KCcvYXV0aC9tZScpO1xyXG4gICAgICBjb25zdCB1c2VyRGF0YSA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgIFxyXG4gICAgICAvLyBFbnN1cmUgcHJvZmlsZSBwaWN0dXJlIFVSTCBpcyBhYnNvbHV0ZVxyXG4gICAgICBpZiAodXNlckRhdGEucHJvZmlsZV9waWN0dXJlKSB7XHJcbiAgICAgICAgdXNlckRhdGEucHJvZmlsZV9waWN0dXJlID0gZW5zdXJlQWJzb2x1dGVVcmwodXNlckRhdGEucHJvZmlsZV9waWN0dXJlKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgc2V0VXNlcih1c2VyRGF0YSk7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyJywgSlNPTi5zdHJpbmdpZnkodXNlckRhdGEpKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVzZXI6IHVzZXJEYXRhIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyBUb2tlbiBpbnZhbGlkLCBjbGVhciBzdG9yYWdlXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpO1xyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlcicpO1xyXG4gICAgICBzZXRUb2tlbihudWxsKTtcclxuICAgICAgc2V0VXNlcihudWxsKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiBlcnJvci5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGZldGNoIHVzZXInLFxyXG4gICAgICB9O1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgbG9naW4gPSBhc3luYyAoZW1haWwsIHBhc3N3b3JkKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBWYWxpZGF0ZSBpbnB1dHMgYmVmb3JlIHNlbmRpbmdcclxuICAgICAgaWYgKCFlbWFpbCB8fCAhcGFzc3dvcmQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnRW1haWwgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCcsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGkucG9zdCgnL2F1dGgvbG9naW4nLCB7IGVtYWlsLCBwYXNzd29yZCB9KTtcclxuICAgICAgY29uc3QgeyB0b2tlbjogbmV3VG9rZW4sIHVzZXI6IHVzZXJEYXRhIH0gPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICBcclxuICAgICAgLy8gRW5zdXJlIHByb2ZpbGUgcGljdHVyZSBVUkwgaXMgYWJzb2x1dGVcclxuICAgICAgaWYgKHVzZXJEYXRhLnByb2ZpbGVfcGljdHVyZSkge1xyXG4gICAgICAgIHVzZXJEYXRhLnByb2ZpbGVfcGljdHVyZSA9IGVuc3VyZUFic29sdXRlVXJsKHVzZXJEYXRhLnByb2ZpbGVfcGljdHVyZSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0b2tlbicsIG5ld1Rva2VuKTtcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXInLCBKU09OLnN0cmluZ2lmeSh1c2VyRGF0YSkpO1xyXG4gICAgICBzZXRUb2tlbihuZXdUb2tlbik7XHJcbiAgICAgIHNldFVzZXIodXNlckRhdGEpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbGV0IG1lc3NhZ2UgPSAnTG9naW4gZmFpbGVkJztcclxuICAgICAgXHJcbiAgICAgIGlmIChlcnJvci5yZXNwb25zZT8uc3RhdHVzID09PSA0MjIpIHtcclxuICAgICAgICAvLyBWYWxpZGF0aW9uIGVycm9yc1xyXG4gICAgICAgIGNvbnN0IGVycm9ycyA9IGVycm9yLnJlc3BvbnNlLmRhdGE/LmVycm9ycztcclxuICAgICAgICBpZiAoZXJyb3JzKSB7XHJcbiAgICAgICAgICAvLyBHZXQgZmlyc3QgZXJyb3IgbWVzc2FnZVxyXG4gICAgICAgICAgY29uc3QgZXJyb3JLZXlzID0gT2JqZWN0LmtleXMoZXJyb3JzKTtcclxuICAgICAgICAgIGlmIChlcnJvcktleXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdEVycm9yID0gZXJyb3JzW2Vycm9yS2V5c1swXV07XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBBcnJheS5pc0FycmF5KGZpcnN0RXJyb3IpID8gZmlyc3RFcnJvclswXSA6IGZpcnN0RXJyb3I7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBtZXNzYWdlID0gZXJyb3IucmVzcG9uc2UuZGF0YT8ubWVzc2FnZSB8fCAnVmFsaWRhdGlvbiBmYWlsZWQnO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBtZXNzYWdlID0gZXJyb3IucmVzcG9uc2UuZGF0YT8ubWVzc2FnZSB8fCBtZXNzYWdlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChlcnJvci5yZXNwb25zZT8uc3RhdHVzID09PSA0MDEpIHtcclxuICAgICAgICBtZXNzYWdlID0gJ0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQnO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1lc3NhZ2UgPSBlcnJvci5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCBtZXNzYWdlO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmVycm9yKCdMb2dpbiBlcnJvcjonLCBlcnJvci5yZXNwb25zZT8uZGF0YSB8fCBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCByZWdpc3RlciA9IGFzeW5jICh1c2VyRGF0YSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGkucG9zdCgnL2F1dGgvcmVnaXN0ZXInLCB1c2VyRGF0YSk7XHJcbiAgICAgIGNvbnN0IHsgdG9rZW46IG5ld1Rva2VuLCB1c2VyOiBuZXdVc2VyLCBtZXNzYWdlIH0gPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICBcclxuICAgICAgLy8gRW5zdXJlIHByb2ZpbGUgcGljdHVyZSBVUkwgaXMgYWJzb2x1dGVcclxuICAgICAgaWYgKG5ld1VzZXIucHJvZmlsZV9waWN0dXJlKSB7XHJcbiAgICAgICAgbmV3VXNlci5wcm9maWxlX3BpY3R1cmUgPSBlbnN1cmVBYnNvbHV0ZVVybChuZXdVc2VyLnByb2ZpbGVfcGljdHVyZSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0b2tlbicsIG5ld1Rva2VuKTtcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXInLCBKU09OLnN0cmluZ2lmeShuZXdVc2VyKSk7XHJcbiAgICAgIHNldFRva2VuKG5ld1Rva2VuKTtcclxuICAgICAgc2V0VXNlcihuZXdVc2VyKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogbWVzc2FnZSB8fCAnUmVnaXN0cmF0aW9uIHN1Y2Nlc3NmdWwhIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsIHRvIHZlcmlmeSB5b3VyIGFjY291bnQuJ1xyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbGV0IG1lc3NhZ2UgPSAnUmVnaXN0cmF0aW9uIGZhaWxlZCc7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZXJyb3IucmVzcG9uc2U/LnN0YXR1cyA9PT0gNDIyKSB7XHJcbiAgICAgICAgLy8gVmFsaWRhdGlvbiBlcnJvcnNcclxuICAgICAgICBjb25zdCBlcnJvcnMgPSBlcnJvci5yZXNwb25zZS5kYXRhPy5lcnJvcnM7XHJcbiAgICAgICAgaWYgKGVycm9ycykge1xyXG4gICAgICAgICAgY29uc3QgZXJyb3JLZXlzID0gT2JqZWN0LmtleXMoZXJyb3JzKTtcclxuICAgICAgICAgIGlmIChlcnJvcktleXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdEVycm9yID0gZXJyb3JzW2Vycm9yS2V5c1swXV07XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBBcnJheS5pc0FycmF5KGZpcnN0RXJyb3IpID8gZmlyc3RFcnJvclswXSA6IGZpcnN0RXJyb3I7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBtZXNzYWdlID0gZXJyb3IucmVzcG9uc2UuZGF0YT8ubWVzc2FnZSB8fCBtZXNzYWdlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBtZXNzYWdlID0gZXJyb3IucmVzcG9uc2UuZGF0YT8ubWVzc2FnZSB8fCBtZXNzYWdlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBtZXNzYWdlID0gZXJyb3IucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgbWVzc2FnZTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGxvZ291dCA9IGFzeW5jICgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IGFwaS5wb3N0KCcvYXV0aC9sb2dvdXQnKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGlmIChlcnJvci5yZXNwb25zZT8uc3RhdHVzICE9PSA0MDEpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdMb2dvdXQgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICAvLyBDbGVhciBzdGF0ZSBmaXJzdFxyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW4nKTtcclxuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXInKTtcclxuICAgICAgc2V0VG9rZW4obnVsbCk7XHJcbiAgICAgIHNldFVzZXIobnVsbCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgdXBkYXRlVXNlciA9ICh1c2VyRGF0YSkgPT4ge1xyXG4gICAgLy8gRW5zdXJlIHByb2ZpbGUgcGljdHVyZSBVUkwgaXMgYWJzb2x1dGUgYmVmb3JlIHVwZGF0aW5nXHJcbiAgICBpZiAodXNlckRhdGEucHJvZmlsZV9waWN0dXJlKSB7XHJcbiAgICAgIHVzZXJEYXRhLnByb2ZpbGVfcGljdHVyZSA9IGVuc3VyZUFic29sdXRlVXJsKHVzZXJEYXRhLnByb2ZpbGVfcGljdHVyZSk7XHJcbiAgICB9XHJcbiAgICBzZXRVc2VyKHVzZXJEYXRhKTtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyJywgSlNPTi5zdHJpbmdpZnkodXNlckRhdGEpKTtcclxuICB9O1xyXG5cclxuICBjb25zdCB2YWx1ZSA9IHtcclxuICAgIHVzZXIsXHJcbiAgICB0b2tlbixcclxuICAgIHNldFVzZXIsXHJcbiAgICBzZXRUb2tlbixcclxuICAgIGxvZ2luLFxyXG4gICAgcmVnaXN0ZXIsXHJcbiAgICBsb2dvdXQsXHJcbiAgICBmZXRjaEN1cnJlbnRVc2VyLFxyXG4gICAgdXBkYXRlVXNlcixcclxuICAgIGxvYWRpbmcsXHJcbiAgICBpc0F1dGhlbnRpY2F0ZWQ6ICEhdXNlciAmJiAhIXRva2VuLFxyXG4gICAgLy8gQ29vcmRpbmF0b3JzIGhhdmUgYWRtaW4gcHJpdmlsZWdlc1xyXG4gICAgaXNBZG1pbjogdXNlcj8ucm9sZSA9PT0gJ2FkbWluJyB8fCB1c2VyPy5yb2xlID09PSAnY29vcmRpbmF0b3InLFxyXG4gICAgaXNDb29yZGluYXRvcjogdXNlcj8ucm9sZSA9PT0gJ2Nvb3JkaW5hdG9yJyxcclxuICB9O1xyXG5cclxuICByZXR1cm4gPEF1dGhDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXt2YWx1ZX0+e2NoaWxkcmVufTwvQXV0aENvbnRleHQuUHJvdmlkZXI+O1xyXG59O1xyXG5cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxNQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxXQUFBLEdBQUFILE9BQUE7QUFBd0QsSUFBQUksV0FBQSxHQUFBSixPQUFBO0FBQUEsU0FBQUUsdUJBQUFHLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFFeEQsTUFBTUcsV0FBVyxnQkFBRyxJQUFBQyxvQkFBYSxFQUFDLENBQUM7QUFFNUIsTUFBTUMsT0FBTyxHQUFHQSxDQUFBLEtBQU07RUFDM0IsTUFBTUMsT0FBTyxHQUFHLElBQUFDLGlCQUFVLEVBQUNKLFdBQVcsQ0FBQztFQUN2QyxJQUFJLENBQUNHLE9BQU8sRUFBRTtJQUNaLE1BQU0sSUFBSUUsS0FBSyxDQUFDLDZDQUE2QyxDQUFDO0VBQ2hFO0VBQ0EsT0FBT0YsT0FBTztBQUNo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LElBQUksQ0FBQyxjQUFjLENBQUM7SUFDaEMsQ0FBQyxDQUFDLE9BQU9OLEtBQUssRUFBRTtNQUNkLElBQUlBLEtBQUssQ0FBQ1QsUUFBUSxFQUFFaUIsTUFBTSxLQUFLLEdBQUcsRUFBRTtRQUNsQ1MsT0FBTyxDQUFDakIsS0FBSyxDQUFDLGVBQWUsRUFBRUEsS0FBSyxDQUFDO01BQ3ZDO0lBQ0YsQ0FBQyxTQUFTO01BQ1I7TUFDQWYsWUFBWSxDQUFDZ0IsVUFBVSxDQUFDLE9BQU8sQ0FBQztNQUNoQ2hCLFlBQVksQ0FBQ2dCLFVBQVUsQ0FBQyxNQUFNLENBQUM7TUFDL0JyQixRQUFRLENBQUMsSUFBSSxDQUFDO01BQ2RILE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFDZjtFQUNGLENBQUM7RUFFRCxNQUFNNEMsVUFBVSxHQUFJbEMsUUFBUSxJQUFLO0lBQy9CO0lBQ0EsSUFBSUEsUUFBUSxDQUFDUSxlQUFlLEVBQUU7TUFDNUJSLFFBQVEsQ0FBQ1EsZUFBZSxHQUFHLElBQUFDLDZCQUFpQixFQUFDVCxRQUFRLENBQUNRLGVBQWUsQ0FBQztJQUN4RTtJQUNBbEIsT0FBTyxDQUFDVSxRQUFRLENBQUM7SUFDakJGLFlBQVksQ0FBQ1ksT0FBTyxDQUFDLE1BQU0sRUFBRVQsSUFBSSxDQUFDVSxTQUFTLENBQUNYLFFBQVEsQ0FBQyxDQUFDO0VBQ3hELENBQUM7RUFFRCxNQUFNbUMsS0FBSyxHQUFHO0lBQ1o5QyxJQUFJO0lBQ0pHLEtBQUs7SUFDTEYsT0FBTztJQUNQRyxRQUFRO0lBQ1J1QixLQUFLO0lBQ0xlLFFBQVE7SUFDUkUsTUFBTTtJQUNOOUIsZ0JBQWdCO0lBQ2hCK0IsVUFBVTtJQUNWeEMsT0FBTztJQUNQMEMsZUFBZSxFQUFFLENBQUMsQ0FBQy9DLElBQUksSUFBSSxDQUFDLENBQUNHLEtBQUs7SUFDbEM7SUFDQTZDLE9BQU8sRUFBRWhELElBQUksRUFBRWlELElBQUksS0FBSyxPQUFPLElBQUlqRCxJQUFJLEVBQUVpRCxJQUFJLEtBQUssYUFBYTtJQUMvREMsYUFBYSxFQUFFbEQsSUFBSSxFQUFFaUQsSUFBSSxLQUFLO0VBQ2hDLENBQUM7RUFFRCxvQkFBTyxJQUFBOUQsV0FBQSxDQUFBZ0UsR0FBQSxFQUFDNUQsV0FBVyxDQUFDNkQsUUFBUTtJQUFDTixLQUFLLEVBQUVBLEtBQU07SUFBQS9DLFFBQUEsRUFBRUE7RUFBUSxDQUF1QixDQUFDO0FBQzlFLENBQUM7QUFBQ0YsT0FBQSxDQUFBQyxZQUFBLEdBQUFBLFlBQUEiLCJpZ25vcmVMaXN0IjpbXX0=