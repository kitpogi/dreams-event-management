{"version":3,"names":["_react","require","_axios","_interopRequireDefault","_imageUtils","_jsxRuntime","e","__esModule","default","AuthContext","createContext","useAuth","context","useContext","Error","exports","AuthProvider","children","user","setUser","useState","token","setToken","loading","setLoading","useEffect","storedToken","localStorage","getItem","userData","JSON","parse","fetchCurrentUser","response","api","get","data","profile_picture","ensureAbsoluteUrl","setItem","stringify","success","error","removeItem","message","login","email","password","post","newToken","status","errors","errorKeys","Object","keys","length","firstError","Array","isArray","console","register","newUser","logout","updateUser","value","isAuthenticated","isAdmin","role","isCoordinator","jsx","Provider"],"sources":["AuthContext.jsx"],"sourcesContent":["import { createContext, useState, useContext, useEffect } from 'react';\r\nimport api from '../api/axios';\r\nimport { ensureAbsoluteUrl } from '../utils/imageUtils';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [token, setToken] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const storedToken = localStorage.getItem('token');\r\n    const userData = localStorage.getItem('user');\r\n    \r\n    if (storedToken && userData) {\r\n      setToken(storedToken);\r\n      setUser(JSON.parse(userData));\r\n      // Fetch current user to verify token is still valid\r\n      fetchCurrentUser();\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const fetchCurrentUser = async () => {\r\n    try {\r\n      const response = await api.get('/auth/me');\r\n      const userData = response.data;\r\n      \r\n      // Ensure profile picture URL is absolute\r\n      if (userData.profile_picture) {\r\n        userData.profile_picture = ensureAbsoluteUrl(userData.profile_picture);\r\n      }\r\n      \r\n      setUser(userData);\r\n      localStorage.setItem('user', JSON.stringify(userData));\r\n      \r\n      return { success: true, user: userData };\r\n    } catch (error) {\r\n      // Token invalid, clear storage\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('user');\r\n      setToken(null);\r\n      setUser(null);\r\n      return {\r\n        success: false,\r\n        message: error.response?.data?.message || 'Failed to fetch user',\r\n      };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      // Validate inputs before sending\r\n      if (!email || !password) {\r\n        return {\r\n          success: false,\r\n          message: 'Email and password are required',\r\n        };\r\n      }\r\n\r\n      const response = await api.post('/auth/login', { email, password });\r\n      const { token: newToken, user: userData } = response.data;\r\n      \r\n      // Ensure profile picture URL is absolute\r\n      if (userData.profile_picture) {\r\n        userData.profile_picture = ensureAbsoluteUrl(userData.profile_picture);\r\n      }\r\n      \r\n      localStorage.setItem('token', newToken);\r\n      localStorage.setItem('user', JSON.stringify(userData));\r\n      setToken(newToken);\r\n      setUser(userData);\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      let message = 'Login failed';\r\n      \r\n      if (error.response?.status === 422) {\r\n        // Validation errors\r\n        const errors = error.response.data?.errors;\r\n        if (errors) {\r\n          // Get first error message\r\n          const errorKeys = Object.keys(errors);\r\n          if (errorKeys.length > 0) {\r\n            const firstError = errors[errorKeys[0]];\r\n            message = Array.isArray(firstError) ? firstError[0] : firstError;\r\n          } else {\r\n            message = error.response.data?.message || 'Validation failed';\r\n          }\r\n        } else {\r\n          message = error.response.data?.message || message;\r\n        }\r\n      } else if (error.response?.status === 401) {\r\n        message = 'Invalid email or password';\r\n      } else {\r\n        message = error.response?.data?.message || message;\r\n      }\r\n      \r\n      console.error('Login error:', error.response?.data || error.message);\r\n      \r\n      return {\r\n        success: false,\r\n        message: message,\r\n      };\r\n    }\r\n  };\r\n\r\n  const register = async (userData) => {\r\n    try {\r\n      const response = await api.post('/auth/register', userData);\r\n      const { token: newToken, user: newUser, message } = response.data;\r\n      \r\n      // Ensure profile picture URL is absolute\r\n      if (newUser.profile_picture) {\r\n        newUser.profile_picture = ensureAbsoluteUrl(newUser.profile_picture);\r\n      }\r\n      \r\n      localStorage.setItem('token', newToken);\r\n      localStorage.setItem('user', JSON.stringify(newUser));\r\n      setToken(newToken);\r\n      setUser(newUser);\r\n      \r\n      return { \r\n        success: true,\r\n        message: message || 'Registration successful! Please check your email to verify your account.'\r\n      };\r\n    } catch (error) {\r\n      let message = 'Registration failed';\r\n      \r\n      if (error.response?.status === 422) {\r\n        // Validation errors\r\n        const errors = error.response.data?.errors;\r\n        if (errors) {\r\n          const errorKeys = Object.keys(errors);\r\n          if (errorKeys.length > 0) {\r\n            const firstError = errors[errorKeys[0]];\r\n            message = Array.isArray(firstError) ? firstError[0] : firstError;\r\n          } else {\r\n            message = error.response.data?.message || message;\r\n          }\r\n        } else {\r\n          message = error.response.data?.message || message;\r\n        }\r\n      } else {\r\n        message = error.response?.data?.message || message;\r\n      }\r\n      \r\n      return {\r\n        success: false,\r\n        message: message,\r\n      };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await api.post('/auth/logout');\r\n    } catch (error) {\r\n      if (error.response?.status !== 401) {\r\n        console.error('Logout error:', error);\r\n      }\r\n    } finally {\r\n      // Clear state first\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('user');\r\n      setToken(null);\r\n      setUser(null);\r\n    }\r\n  };\r\n\r\n  const updateUser = (userData) => {\r\n    // Ensure profile picture URL is absolute before updating\r\n    if (userData.profile_picture) {\r\n      userData.profile_picture = ensureAbsoluteUrl(userData.profile_picture);\r\n    }\r\n    setUser(userData);\r\n    localStorage.setItem('user', JSON.stringify(userData));\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    token,\r\n    setUser,\r\n    setToken,\r\n    login,\r\n    register,\r\n    logout,\r\n    fetchCurrentUser,\r\n    updateUser,\r\n    loading,\r\n    isAuthenticated: !!user && !!token,\r\n    // Coordinators have admin privileges\r\n    isAdmin: user?.role === 'admin' || user?.role === 'coordinator',\r\n    isCoordinator: user?.role === 'coordinator',\r\n  };\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n};\r\n\r\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,WAAA,GAAAH,OAAA;AAAwD,IAAAI,WAAA,GAAAJ,OAAA;AAAA,SAAAE,uBAAAG,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAExD,MAAMG,WAAW,gBAAG,IAAAC,oBAAa,EAAC,CAAC;AAE5B,MAAMC,OAAO,GAAGA,CAAA,KAAM;EAC3B,MAAMC,OAAO,GAAG,IAAAC,iBAAU,EAACJ,WAAW,CAAC;EACvC,IAAI,CAACG,OAAO,EAAE;IACZ,MAAM,IAAIE,KAAK,CAAC,6CAA6C,CAAC;EAChE;EACA,OAAOF,OAAO;AAChB,CAAC;AAACG,OAAA,CAAAJ,OAAA,GAAAA,OAAA;AAEK,MAAMK,YAAY,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAC5C,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAG,IAAAC,eAAQ,EAAC,IAAI,CAAC;EACtC,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAG,IAAAF,eAAQ,EAAC,IAAI,CAAC;EACxC,MAAM,CAACG,OAAO,EAAEC,UAAU,CAAC,GAAG,IAAAJ,eAAQ,EAAC,IAAI,CAAC;EAE5C,IAAAK,gBAAS,EAAC,MAAM;IACd,MAAMC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IACjD,MAAMC,QAAQ,GAAGF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;IAE7C,IAAIF,WAAW,IAAIG,QAAQ,EAAE;MAC3BP,QAAQ,CAACI,WAAW,CAAC;MACrBP,OAAO,CAACW,IAAI,CAACC,KAAK,CAACF,QAAQ,CAAC,CAAC;MAC7B;MACAG,gBAAgB,CAAC,CAAC;IACpB,CAAC,MAAM;MACLR,UAAU,CAAC,KAAK,CAAC;IACnB;EACF,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMQ,gBAAgB,GAAG,MAAAA,CAAA,KAAY;IACnC,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMC,cAAG,CAACC,GAAG,CAAC,UAAU,CAAC;MAC1C,MAAMN,QAAQ,GAAGI,QAAQ,CAACG,IAAI;;MAE9B;MACA,IAAIP,QAAQ,CAACQ,eAAe,EAAE;QAC5BR,QAAQ,CAACQ,eAAe,GAAG,IAAAC,6BAAiB,EAACT,QAAQ,CAACQ,eAAe,CAAC;MACxE;MAEAlB,OAAO,CAACU,QAAQ,CAAC;MACjBF,YAAY,CAACY,OAAO,CAAC,MAAM,EAAET,IAAI,CAACU,SAAS,CAACX,QAAQ,CAAC,CAAC;MAEtD,OAAO;QAAEY,OAAO,EAAE,IAAI;QAAEvB,IAAI,EAAEW;MAAS,CAAC;IAC1C,CAAC,CAAC,OAAOa,KAAK,EAAE;MACd;MACAf,YAAY,CAACgB,UAAU,CAAC,OAAO,CAAC;MAChChB,YAAY,CAACgB,UAAU,CAAC,MAAM,CAAC;MAC/BrB,QAAQ,CAAC,IAAI,CAAC;MACdH,OAAO,CAAC,IAAI,CAAC;MACb,OAAO;QACLsB,OAAO,EAAE,KAAK;QACdG,OAAO,EAAEF,KAAK,CAACT,QAAQ,EAAEG,IAAI,EAAEQ,OAAO,IAAI;MAC5C,CAAC;IACH,CAAC,SAAS;MACRpB,UAAU,CAAC,KAAK,CAAC;IACnB;EACF,CAAC;EAED,MAAMqB,KAAK,GAAG,MAAAA,CAAOC,KAAK,EAAEC,QAAQ,KAAK;IACvC,IAAI;MACF;MACA,IAAI,CAACD,KAAK,IAAI,CAACC,QAAQ,EAAE;QACvB,OAAO;UACLN,OAAO,EAAE,KAAK;UACdG,OAAO,EAAE;QACX,CAAC;MACH;MAEA,MAAMX,QAAQ,GAAG,MAAMC,cAAG,CAACc,IAAI,CAAC,aAAa,EAAE;QAAEF,KAAK;QAAEC;MAAS,CAAC,CAAC;MACnE,MAAM;QAAE1B,KAAK,EAAE4B,QAAQ;QAAE/B,IAAI,EAAEW;MAAS,CAAC,GAAGI,QAAQ,CAACG,IAAI;;MAEzD;MACA,IAAIP,QAAQ,CAACQ,eAAe,EAAE;QAC5BR,QAAQ,CAACQ,eAAe,GAAG,IAAAC,6BAAiB,EAACT,QAAQ,CAACQ,eAAe,CAAC;MACxE;MAEAV,YAAY,CAACY,OAAO,CAAC,OAAO,EAAEU,QAAQ,CAAC;MACvCtB,YAAY,CAACY,OAAO,CAAC,MAAM,EAAET,IAAI,CAACU,SAAS,CAACX,QAAQ,CAAC,CAAC;MACtDP,QAAQ,CAAC2B,QAAQ,CAAC;MAClB9B,OAAO,CAACU,QAAQ,CAAC;MAEjB,OAAO;QAAEY,OAAO,EAAE;MAAK,CAAC;IAC1B,CAAC,CAAC,OAAOC,KAAK,EAAE;MACd,IAAIE,OAAO,GAAG,cAAc;MAE5B,IAAIF,KAAK,CAACT,QAAQ,EAAEiB,MAAM,KAAK,GAAG,EAAE;QAClC;QACA,MAAMC,MAAM,GAAGT,KAAK,CAACT,QAAQ,CAACG,IAAI,EAAEe,MAAM;QAC1C,IAAIA,MAAM,EAAE;UACV;UACA,MAAMC,SAAS,GAAGC,MAAM,CAACC,IAAI,CAACH,MAAM,CAAC;UACrC,IAAIC,SAAS,CAACG,MAAM,GAAG,CAAC,EAAE;YACxB,MAAMC,UAAU,GAAGL,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC,CAAC;YACvCR,OAAO,GAAGa,KAAK,CAACC,OAAO,CAACF,UAAU,CAAC,GAAGA,UAAU,CAAC,CAAC,CAAC,GAAGA,UAAU;UAClE,CAAC,MAAM;YACLZ,OAAO,GAAGF,KAAK,CAACT,QAAQ,CAACG,IAAI,EAAEQ,OAAO,IAAI,mBAAmB;UAC/D;QACF,CAAC,MAAM;UACLA,OAAO,GAAGF,KAAK,CAACT,QAAQ,CAACG,IAAI,EAAEQ,OAAO,IAAIA,OAAO;QACnD;MACF,CAAC,MAAM,IAAIF,KAAK,CAACT,QAAQ,EAAEiB,MAAM,KAAK,GAAG,EAAE;QACzCN,OAAO,GAAG,2BAA2B;MACvC,CAAC,MAAM;QACLA,OAAO,GAAGF,KAAK,CAACT,QAAQ,EAAEG,IAAI,EAAEQ,OAAO,IAAIA,OAAO;MACpD;MAEAe,OAAO,CAACjB,KAAK,CAAC,cAAc,EAAEA,KAAK,CAACT,QAAQ,EAAEG,IAAI,IAAIM,KAAK,CAACE,OAAO,CAAC;MAEpE,OAAO;QACLH,OAAO,EAAE,KAAK;QACdG,OAAO,EAAEA;MACX,CAAC;IACH;EACF,CAAC;EAED,MAAMgB,QAAQ,GAAG,MAAO/B,QAAQ,IAAK;IACnC,IAAI;MACF,MAAMI,QAAQ,GAAG,MAAMC,cAAG,CAACc,IAAI,CAAC,gBAAgB,EAAEnB,QAAQ,CAAC;MAC3D,MAAM;QAAER,KAAK,EAAE4B,QAAQ;QAAE/B,IAAI,EAAE2C,OAAO;QAAEjB;MAAQ,CAAC,GAAGX,QAAQ,CAACG,IAAI;;MAEjE;MACA,IAAIyB,OAAO,CAACxB,eAAe,EAAE;QAC3BwB,OAAO,CAACxB,eAAe,GAAG,IAAAC,6BAAiB,EAACuB,OAAO,CAACxB,eAAe,CAAC;MACtE;MAEAV,YAAY,CAACY,OAAO,CAAC,OAAO,EAAEU,QAAQ,CAAC;MACvCtB,YAAY,CAACY,OAAO,CAAC,MAAM,EAAET,IAAI,CAACU,SAAS,CAACqB,OAAO,CAAC,CAAC;MACrDvC,QAAQ,CAAC2B,QAAQ,CAAC;MAClB9B,OAAO,CAAC0C,OAAO,CAAC;MAEhB,OAAO;QACLpB,OAAO,EAAE,IAAI;QACbG,OAAO,EAAEA,OAAO,IAAI;MACtB,CAAC;IACH,CAAC,CAAC,OAAOF,KAAK,EAAE;MACd,IAAIE,OAAO,GAAG,qBAAqB;MAEnC,IAAIF,KAAK,CAACT,QAAQ,EAAEiB,MAAM,KAAK,GAAG,EAAE;QAClC;QACA,MAAMC,MAAM,GAAGT,KAAK,CAACT,QAAQ,CAACG,IAAI,EAAEe,MAAM;QAC1C,IAAIA,MAAM,EAAE;UACV,MAAMC,SAAS,GAAGC,MAAM,CAACC,IAAI,CAACH,MAAM,CAAC;UACrC,IAAIC,SAAS,CAACG,MAAM,GAAG,CAAC,EAAE;YACxB,MAAMC,UAAU,GAAGL,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC,CAAC;YACvCR,OAAO,GAAGa,KAAK,CAACC,OAAO,CAACF,UAAU,CAAC,GAAGA,UAAU,CAAC,CAAC,CAAC,GAAGA,UAAU;UAClE,CAAC,MAAM;YACLZ,OAAO,GAAGF,KAAK,CAACT,QAAQ,CAACG,IAAI,EAAEQ,OAAO,IAAIA,OAAO;UACnD;QACF,CAAC,MAAM;UACLA,OAAO,GAAGF,KAAK,CAACT,QAAQ,CAACG,IAAI,EAAEQ,OAAO,IAAIA,OAAO;QACnD;MACF,CAAC,MAAM;QACLA,OAAO,GAAGF,KAAK,CAACT,QAAQ,EAAEG,IAAI,EAAEQ,OAAO,IAAIA,OAAO;MACpD;MAEA,OAAO;QACLH,OAAO,EAAE,KAAK;QACdG,OAAO,EAAEA;MACX,CAAC;IACH;EACF,CAAC;EAED,MAAMkB,MAAM,GAAG,MAAAA,CAAA,KAAY;IACzB,IAAI;MACF,MAAM5B,cAAG,CAACc,IAAI,CAAC,cAAc,CAAC;IAChC,CAAC,CAAC,OAAON,KAAK,EAAE;MACd,IAAIA,KAAK,CAACT,QAAQ,EAAEiB,MAAM,KAAK,GAAG,EAAE;QAClCS,OAAO,CAACjB,KAAK,CAAC,eAAe,EAAEA,KAAK,CAAC;MACvC;IACF,CAAC,SAAS;MACR;MACAf,YAAY,CAACgB,UAAU,CAAC,OAAO,CAAC;MAChChB,YAAY,CAACgB,UAAU,CAAC,MAAM,CAAC;MAC/BrB,QAAQ,CAAC,IAAI,CAAC;MACdH,OAAO,CAAC,IAAI,CAAC;IACf;EACF,CAAC;EAED,MAAM4C,UAAU,GAAIlC,QAAQ,IAAK;IAC/B;IACA,IAAIA,QAAQ,CAACQ,eAAe,EAAE;MAC5BR,QAAQ,CAACQ,eAAe,GAAG,IAAAC,6BAAiB,EAACT,QAAQ,CAACQ,eAAe,CAAC;IACxE;IACAlB,OAAO,CAACU,QAAQ,CAAC;IACjBF,YAAY,CAACY,OAAO,CAAC,MAAM,EAAET,IAAI,CAACU,SAAS,CAACX,QAAQ,CAAC,CAAC;EACxD,CAAC;EAED,MAAMmC,KAAK,GAAG;IACZ9C,IAAI;IACJG,KAAK;IACLF,OAAO;IACPG,QAAQ;IACRuB,KAAK;IACLe,QAAQ;IACRE,MAAM;IACN9B,gBAAgB;IAChB+B,UAAU;IACVxC,OAAO;IACP0C,eAAe,EAAE,CAAC,CAAC/C,IAAI,IAAI,CAAC,CAACG,KAAK;IAClC;IACA6C,OAAO,EAAEhD,IAAI,EAAEiD,IAAI,KAAK,OAAO,IAAIjD,IAAI,EAAEiD,IAAI,KAAK,aAAa;IAC/DC,aAAa,EAAElD,IAAI,EAAEiD,IAAI,KAAK;EAChC,CAAC;EAED,oBAAO,IAAA9D,WAAA,CAAAgE,GAAA,EAAC5D,WAAW,CAAC6D,QAAQ;IAACN,KAAK,EAAEA,KAAM;IAAA/C,QAAA,EAAEA;EAAQ,CAAuB,CAAC;AAC9E,CAAC;AAACF,OAAA,CAAAC,YAAA,GAAAA,YAAA","ignoreList":[]}